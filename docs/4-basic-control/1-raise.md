# RAISE によるメッセージ出力

## 全体の流れ

| # | テーマ | 概要 |
|---|---|---|
| 1 | [RAISE NOTICE の基本](#0-raise-notice-の基本) | `RAISE NOTICE` でメッセージを出力する |
| 2 | [プレースホルダ (%)](#1-プレースホルダ-) | `%` で値を埋め込んで出力する |
| 3 | [RAISE のレベル](#2-raise-のレベル) | DEBUG / LOG / INFO / NOTICE / WARNING の使い分け |
| 4 | [文字列結合による出力](#3-文字列結合による出力) | `||` で文字列を組み立てて出力する |

---

## 1. RAISE NOTICE の基本

`RAISE NOTICE` でメッセージをコンソールに出力します。

PL/pgSQL では `print` や `console.log` のような汎用的な出力命令はなく、`RAISE NOTICE` を使ってメッセージを表示します。デバッグや処理結果の確認に使います。

```sql
-- ============================================================
-- RAISE NOTICE の基本
-- ============================================================
-- メッセージをコンソールに出力する

DO $$
BEGIN
    RAISE NOTICE 'Hello, PL/pgSQL!';
    RAISE NOTICE 'これは RAISE NOTICE のテストです';
END;
$$;
```

## 2. プレースホルダ (%)

`%` をプレースホルダとして使い、値を埋め込めます。

メッセージ文字列中の `%` は、`RAISE NOTICE` の第 2 引数以降の値で順に置換されます。複数の `%` を並べれば複数の値を 1 行で出力できます。リテラルの `%` を出力したい場合は `%%` と書きます。

```sql
-- ============================================================
-- プレースホルダ (%)
-- ============================================================
-- % は引数の値で順に置換される

DO $$
DECLARE
    v_name  VARCHAR(100) := '田中';
    v_age   INT          := 30;
    v_rate  NUMERIC      := 85.5;
BEGIN
    -- 1 つのプレースホルダ
    RAISE NOTICE '名前: %', v_name;

    -- 複数のプレースホルダ
    RAISE NOTICE '名前: %, 年齢: %, 達成率: %', v_name, v_age, v_rate;

    -- リテラルの % を出力する場合は %%
    RAISE NOTICE '達成率: %%%', v_rate;
    -- 出力: 達成率: 85.5%
END;
$$;
```

## 3. RAISE のレベル

`RAISE` には出力レベルがあり、用途に応じて使い分けます。

レベルは `DEBUG` → `LOG` → `INFO` → `NOTICE` → `WARNING` → `EXCEPTION` の順に重要度が上がります。`NOTICE` がデフォルトで最もよく使います。`EXCEPTION` はエラーを発生させるため、ここでは扱いません（[5-exception](6-exception.md) で学びます）。

| レベル | 用途 | psql での表示 |
|---|---|---|
| `DEBUG` | 詳細なデバッグ情報 | デフォルトでは非表示 |
| `LOG` | サーバログ向けの情報 | デフォルトでは非表示 |
| `INFO` | 一般的な情報 | 表示される |
| `NOTICE` | 注意すべき情報 | 表示される |
| `WARNING` | 警告 | 表示される |

```sql
-- ============================================================
-- RAISE のレベル
-- ============================================================
-- レベルによってメッセージの重要度を区別する

DO $$
BEGIN
    RAISE DEBUG   'デバッグ: この行は通常表示されません';
    RAISE LOG     'ログ: この行も通常表示されません';
    RAISE INFO    '情報: 一般的な情報です';
    RAISE NOTICE  '通知: 最もよく使うレベルです';
    RAISE WARNING '警告: 注意が必要な状況です';
END;
$$;
```

## 4. 文字列結合による出力

`||` で文字列を結合してからプレースホルダに渡すこともできます。

プレースホルダだけでは表現しにくい場合、`||` で文字列を組み立ててから出力できます。数値に単位を付ける場合などに便利です。

```sql
-- ============================================================
-- 文字列結合による出力
-- ============================================================
-- || で文字列を組み立ててから出力する

DO $$
DECLARE
    v_first_name VARCHAR(50) := '太郎';
    v_last_name  VARCHAR(50) := '田中';
    v_score      NUMERIC     := 92.5;
BEGIN
    -- || で結合した文字列を出力
    RAISE NOTICE '氏名: %', v_last_name || ' ' || v_first_name;

    -- 数値に単位を付ける
    RAISE NOTICE 'スコア: %', v_score || '点';

    -- % を値の後ろに付ける場合は || を使う
    RAISE NOTICE '進捗: %', v_score || '%';
END;
$$;
```

---

[BASIC_CONTROL](README.md) | [次へ: 変数](2-variables.md) →
